---
title: "Astro 2.5"
description: "Data collections • Hybrid rendering • Custom client directives • HTML minification • Parallelized rendering • Polymorphic type helper • More!"
publishDate: "May 18, 2023"
authors:
  - matthew
coverImage: "/src/content/blog/_images/astro-240/blog-hero-2_4-release.jpg"
socialImage: "/src/content/blog/_images/astro-240/og-image-2_4-release.jpg"
lang: "en"
---

Astro 2.5 just dropped, and features:

- **[Data collections and references](#data-collections)**: Your `src/content` folder can now includes JSON and YAML files to store data. You can reference this data from your other collections.
- **[Hybrid rendering (experimental)](#static-default)**: Static sites sometimes need a few server routes too.
- **[Custom client directives (experimental)](#cc)**: A new API for integrations to define their own load mechanics for `client:` directives.
- **[HTML minification]()**: An option to allow you to minify your Astro templates.
- **[Parallelized rendering]()**: Astro now runs sibling components in parallel, speeding up rendering when you have multiple components doing their own data loading.
- **[Polymorphic type helper]()**: I don't know what this is

## Data collections and references

## Static by default hybrid rendering (experimental)

Enable experimental support for hybrid SSR with pre-rendering enabled by default

**astro.config.mjs**

```js
import { defineConfig } from 'astro/config';
export defaultdefineConfig({
   output: 'hybrid',
       experimental: {
       hybridOutput: true,
   },
});
```

Then add `export const prerender =  false` to any page or endpoint you want to opt-out of pre-rendering.

**src/pages/contact.astro**

```astro
---
export const prerender = false

if (Astro.request.method === "POST") {
	// handle form submission
}
---

<form method="POST">
	<input type="text" name="name" />
	<input type="email" name="email" />
	<button type="submit">Submit</button>
</form>
```

## Custom client directives (experimental)

Integrations can add new `client:` directives through the `astro:config:setup` hook's `addClientDirective()` API. To enable this API, the user needs to set `experimental.customClientDirectives` to `true` in their config.

```js
import { defineConfig } from "astro/config"
import onClickDirective from "astro-click-directive"

export default defineConfig({
	integrations: [onClickDirective()],
	experimental: {
		customClientDirectives: true,
	},
})
```

```js
export default function onClickDirective() {
	return {
		hooks: {
			"astro:config:setup": ({ addClientDirective }) => {
				addClientDirective({
					name: "click",
					entrypoint: "astro-click-directive/click.js",
				})
			},
		},
	}
}
```

```astro
<Counter client:click />
```

The client directive file (e.g. `astro-click-directive/click.js`) should export a function of type `ClientDirective`:

```ts
import type { ClientDirective } from "astro"

const clickDirective: ClientDirective = (load, opts, el) => {
	window.addEventListener(
		"click",
		async () => {
			const hydrate = await load()
			await hydrate()
		},
		{ once: true },
	)
}

export default clickDirective
```

## HTML minification

You can now opt-in to minification of the HTML produced by your Astro components.

Using the `compressHTML` option Astro will remove all whitespace.

We wanted to enable minification without sacrificing performance. For server-rendered apps, doing minification on each render could be costly. With `compressHTML` your components are compressed by the Astro compiler, only once and during the build.

You can enable this in your config:

```js
import { defineConfig } from "astro/config"
export default defineConfig({
	compressHTML: true,
})
```

Compression occurs both in development mode and in the final build.

This option _will not_ compress HTML produced by framework components. If you'd like that functionality it can easily be achieved by writing a [middleware](https://docs.astro.build/en/guides/middleware/) to compress HTML responses.

## Parallelized rendering

When rendering components Astro will now render them in parallel, allowing components that do their own data loading to not be blocked by other components higher in the tree that are also loading data. A simple example:

```astro
<Delayed ms={30} />
<Delayed ms={20} />
<Delayed ms={40} />
<Delayed ms={10} />
```

This `<Delayed />` component waits a number of milliseconds. In the past each component would need to wait for the previous to finish before it started rendering. In 2.5 these will now all render at the same time.

We attempted to add this optimization in the past but were lacking good benchmarks to ensure that this didn't actually _slow down_ rendering. Recent improvements to our benchmarking CI infrastructure has now allowed us to implement this with confidence.

## Polymorphic type helper

Astro now includes a TypeScript helper (`Polymorphic`) to make it easier to build components that can render as different HTML elements with full type safety. This is useful for components like `<Link>` that can render as either `<a>` or `<button>` depending on the props passed to it.

The example below implements a fully-typed, polymorphic component that can render as any HTML element. The HTMLTag type is used to ensure that the as prop is a valid HTML element.

```astro
---
import { HTMLTag, Polymorphic } from "astro/types"

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }>

const { as: Tag, ...props } = Astro.props
---

<Tag {...props} />
```

## More

TODO

Additional bug fixes and integration features are included in this release. Check out the [release notes](https://github.com/withastro/astro/pull/7090) to learn more.
