---
title: "Astro 4.6"
description: "Astro 4.6 is here! This release includes a new manual routing strategy for internationalization, the ability to move the dev toolbar, experimental support for CSRF protection, and more."
publishDate: "April 11, 2024"
authors:
  - erika
  - ema
  - matthew
  - nate
  - bjorn
coverImage: "/src/content/blog/_images/astro-460/post-header-4.6.webp"
socialImage: "/src/content/blog/_images/astro-460/og-image-4.6.webp"
lang: "en"
---

import BlogSummary from "/src/components/BlogSummary.astro";

<BlogSummary>
  After a short break post-launch week, Astro 4.6 is now here and we're back to our regular schedule! This release includes a new manual routing strategy for internationalization, experimental support for CSRF protection, a new feature for the dev toolbar and more.
</BlogSummary>

Full release highlights include:

- [**Manual i18n routing strategy**](#manual-routing-strategy-for-internationalization)
- [**Ability to move the dev toolbar**](#ability-to-move-the-dev-toolbar)
- [**Experimental: Support for CSRF protection**](#experimental-support-for-csrf-protection)
- [**Cookies improvements**](#cookies-improvements)
- [**Deprecated support for older versions of Node](#deprecated-support-for-older-versions-of-node)

To upgrade an existing project, use the automated `@astrojs/upgrade` CLI tool. Alternatively, upgrade manually by running the upgrade command for your package manager:

```sh
# Recommended:
npx @astrojs/upgrade

# Manual:
npm install astro@latest
pnpm upgrade astro --latest
yarn upgrade astro --latest
```

## Deprecated support for older versions of Node

In accordance with [our Node support and upgrade policy](https://docs.astro.build/en/upgrade-astro/#nodejs-support-and-upgrade-policies), this version of Astro deprecate support for versions of Node lower than 18.17.1, Node 19 and versions of Node lower than 20.3.0. As always, this decision wasn't reached lightly, and we believe this change will result in a more stable and secure Astro experience for all users.

Astro will still work on these older versions of Node until Astro 5, however you may see a warning when installing Astro and certain features may not work as expected.

## Manual routing strategy for internationalization

Astro 4.6 introduces a new manual routing strategy for internationalization. This new strategy allows you to take total control over the routing of your internationalized Astro website, for cases where the default routing strategy doesn't quite meet your needs.

To enable manual routing, set the `i18n.strategy` option in your `astro.config.mjs` to `manual`:

```js
// astro.config.mjs
import { defineConfig } from "astro/config";

export default defineConfig({
  i18n: {
    locales: ["en", "fr"],
    defaultLocale: "fr",
    routing: "manual",
  },
});
```

and then [add a middleware](https://docs.astro.build/en/guides/middleware/) to your project to handle the routing:

```ts
// src/middleware.ts
import { redirectToDefaultLocale } from "astro:i18n";

// Example middleware that redirects all requests to the default locale apart for the /about page
export const onRequest = defineMiddleware(async (context, next) => {
  if (context.url.startsWith("/about")) {
    return next();
  } else {
    return redirectToDefaultLocale(context, 302);
  }
});
```

Check out the [internationalization documentation](https://docs.astro.build/en/guides/internationalization/) for more information on how to use manual routing with internationalization.

## Ability to move the dev toolbar

Astro 4.6 introduces the ability to move the dev toolbar to different positions at the bottom of your screen. This can be useful if you have a sticky header that covers the bottom of the screen, or if you just prefer the toolbar to be somewhere else. The dev toolbar is there to help you, not get in your way! Thanks to [Ming-jun Lu](https://github.com/mingjunlu) for contributing this requested feature!

## Experimental: Support for CSRF protection

Astro 4.6 adds experimental partial support for [CSRF protection](https://developer.mozilla.org/en-US/docs/Glossary/CSRF). This feature is currently under an experimental flag and may change in future releases. To enable it, set the `experimental.csrfProtection` and `security.csrfProtection.origin` option in your `astro.config.mjs`:

```js
// astro.config.mjs
import { defineConfig } from "astro/config";

export default defineConfig({
  security: {
    csrfProtection: {
      origin: true,
    },
  },
  experimental: {
    csrfProtection: true,
  },
});
```

Note that this feature is only available for pages that are rendered on-demand (also known as Server Side Rendering).

## Cookies improvements

Thanks to [Farzard](https://github.com/fshafiee), Astro's helper for deleting cookies (`Astro.cookies.delete`) now allowing setting even more cookie attributes instead of just the `path` and `domain` attributes. Perhaps a "bite-sized" change, but definitely one you can sink your teeth into!

## Bug Fixes

You know it, Astro 4.6 includes more bug fixesÂ and smaller improvements that couldn't make it into this release post. Check out the full [release notes](https://github.com/withastro/astro/blob/refs/heads/main/packages/astro/CHANGELOG.md#460) to learn more.
