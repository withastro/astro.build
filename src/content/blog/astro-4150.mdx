---
title: "Astro 4.15"
description: TODO Astro 4.14 is available now! This release includes the first experimental version of the Content Layer API, experimental support for Intellisense inside content files, and more.
homepageLink:
  title: Astro 4.15
  subtitle: Astro Actions
publishDate: "August 29, 2024"
authors:
  - matthew
coverImage: "/src/content/blog/_images/astro-4140/header_astro_4_14.webp"
socialImage: "/src/content/blog/_images/astro-4140/og_image_4_14.webp"
lang: "en"
---

import BlogContentImage from "/src/components/BlogContentImage.astro";
import BlogSummary from "/src/components/BlogSummary.astro";
import frontmatterIntellisense from "/src/content/blog/_images/astro-4140/frontmatter-intellisense.png";

<BlogSummary>
  Astro 4.15 is out now! This release includes the first experimental release of the Content Layer API, our new super-flexible solution for managing content in Astro projects, support for Intellisense inside content files, and more.
</BlogSummary>

This release includes the following highlights:

- [**Astro Actions**](#astro-actions)
- [**LibSQL remotes in @astrojs/db**](#astro-db)
- [**Use rewrites for i18n fallbacks**](#rewrites-in-i18n-fallbacks)
- [**LibSQL remotes in Astro DB**](#libsql-remotes-in-astro-db)
- [**Experimental tsconfig generation**](#experimental-tsconfig-generation)
- [**Timeout option in client:idle**](#timeout-option-in-clientidle)
- [**Swap helpers available for ViewTransitions customizations**](#swap-helpers-for-viewtransitions)
- [**'sync' command added for integrations**](#sync-command-in-integrations-api)

To upgrade an existing project, use the automated `@astrojs/upgrade` CLI tool. Alternatively, upgrade manually by running the upgrade command for your package manager:

```sh
# Recommended:
npx @astrojs/upgrade

# Manual:
npm install astro@latest
pnpm upgrade astro --latest
yarn upgrade astro --latest
```

## Astro Actions

In Astro 4.8 we released experimental support for Astro Actions, 

Blah blah

## Rewrites in i18n fallbacks

A new option was added to [internationalization (i18n) routing](https://docs.astro.build/en/guides/internationalization/) which allows more control over how fallbacks are handled. You can now specify whether a fallback results in a rewrite (a `200` response from the server) or a redirect, the current default.

The fallback system in i18n allows you to define which content is used for a locale when that content is not available in the user's locale. For example your config might look like:

```js
import { defineConfig } from "astro/config"
export default defineConfig({
  i18n: {
    defaultLocale: "en",
    locales: ["es", "en", "fr"],
    fallback: {
      fr: "es"
    },
    routing: {
      fallbackType: "rewrite"
    }
  }
})
```

## LibSQL remotes in Astro DB

You can now specify a [LibSQL](https://turso.tech/libsql) server instance as the remote for `@astrojs/db`. This allows you to self-host your own LibSQL server as an alternative to using Astro DB with Astro Studio. This option works with any supported LibSQL protocol.

To use this feature, set the following environment variables:

- `ASTRO_DB_REMOTE_URL`: the connection URL to your LibSQL server.
- `ASTRO_DB_APP_TOKEN`: the auth token to your LibSQL server.

Enabling this feature allows you to both connect to the LibSQL server in your production environment, it also allows you to use the Astro DB deployment and push (migration) commands with the LibSQL instance.
Thanks to [@Luiz](https://github.com/Fryuni) for this amazing contribution.

## Experimental tsconfig generation

Astro uses some tricks to provide good TypeScript support for dynamic features like Content Collections. There are some limitations to the approach taken. With this new experimental flag we are attempting a new approach where Astro will create a tsconfig for you in `.astro/tsconfig.json`. 

Our hope is to unflag this feature in Astro 5. For those willing to try out the new approach and provide feedback you can enable `experimental.typescript` option in your config. Thanks to [florian-lefebvre](https://github.com/florian-lefebvre) who has been championing recent TypeScript improvements such as this one in Astro.

## Timeout option in `client:idle`

The `client:idle` directive is used to load an [Astro Island](https://docs.astro.build/en/concepts/islands/) when the user's CPU is idle (which no other JavaScript is executing). Under the hood this feature relies on the [requestIdleCallback](https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback) feature of browsers.

New in 4.15, you can specify a `timeout` that will trigger the island to load if it has not already done so in that time. This is useful to add priority to a component that might be competing with other idle components.

```astro
{/* Many many components */}
{Array.from({ length: 3000 }).map((_, i) => (<Counter id={`client-idle-${i}`} count={i} client:idle>
	<h1>Hello, client:idle! ${i}</h1>
</Counter>))}

{/* Component loads after a maximum wait of 500ms */}
<Counter id="client-idle-timeout" {...someProps} client:idle={{ timeout: 500 }}>
	<h1>Hello, client:idle={'{{timeout: 500}}'}!</h1>
</Counter>
```

Thanks to [ph1p](https://github.com/ph1p) for this contribution.

## Swap helpers for ViewTransitions

Astro's `<ViewTransitions />` router works by turning your MPA (multi-page app) into a SPA (single-page app), while attempting to preserve the DX of a MPA. It does this by fetching pages on navigation and swapping the content. In some cases you might want more control over how the swap works, which we allowing by overriding the swap in the [`astro:before-swap`](https://docs.astro.build/en/guides/view-transitions/#astrobefore-swap) event.

In 4.15 we now expose the built-in swap functions in `astro:transitions/client`. These helpers allow you to use parts of what Astro does by default, with your own custom logic in between.

```astro
<script>
import { swapFunctions } from 'astro:transitions/client';
document.addEventListener('astro:before-swap', (e) => { e.swap = () => swapMainOnly(e.newDocument) });
function swapMainOnly(doc: Document) {
  swapFunctions.deselectScripts(doc);
  swapFunctions.swapRootAttributes(doc);
  swapFunctions.swapHeadElements(doc);
  const restoreFocusFunction = swapFunctions.saveFocus();
  const newMain = doc.querySelector('main');
  const oldMain = document.querySelector('main');
  if (newMain && oldMain) {
    swapFunctions.swapBodyElement(newMain, oldMain);
  } else {
    swapFunctions.swapBodyElement(doc.body, document.body);
  }
  restoreFocusFunction();
};
<script>
```

Thanks to [martrapp](https://github.com/martrapp) for this contribution.

## `sync` command in Integrations API

The `command` property in the `astro:config:setup` hook informs integrations triggered the integration to run. Now when the `astro sync` command is run, this property's value is `sync`. Thanks to [ematipico](https://github.com/ematipico) for this contribution.

## Bug Fixes and Special Thanks

As we do, Astro 4.16 includes more bug fixes and smaller improvements that couldn't make it into this post! Check out the full [release notes](https://github.com/withastro/astro/blob/refs/heads/main/packages/astro/CHANGELOG.md#4130) to learn more.

Thanks to [Sarah Rainsberger (@sarah11918)](https://github.com/sarah11918), [Yan (@yanthomasdev)](https://github.com/yanthomasdev), [Bjorn Lu (@bluwy)](https://github.com/bluwy) and everyone else who contributed to this release.
