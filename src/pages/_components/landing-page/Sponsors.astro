---
import { Icon } from 'astro-icon/components';
import StripWidth from './StripWidth.astro';

const exclusiveSponsors = [
	{
		height: 74,
		label: 'Netlify',
		src: 'sponsors/netlify',
		href: 'https://www.netlify.com/?utm_campaign=Astro-2024&utm_source=astro-referral',
		caption: 'Official Deployment Partner',
	},
	{
		height: 32,
		label: 'Webflow',
		src: 'sponsors/webflow',
		caption: 'Official Partner',
		href: 'https://webflow.com/feature/cloud?utm_source=Astro&utm_medium=tech-partner&utm_campaign=fy26-astro&utm_content=fy26-homepage-sponsors',
	},
	{
		height: 68,
		label: 'Cloudflare',
		src: 'sponsors/cloudflare',
		caption: 'Official Partner',
		href: 'https://www.cloudflare.com/?utm_source=astro&utm_medium=astro&utm_campaign=astro',
	},
	// Temporarily moved here to keep the layout tidy
	{
		height: 26,
		label: 'Mux',
		src: 'sponsors/mux',
		caption: 'Official Video Partner',
		href: 'https://www.mux.com?utm_campaign=21819274-Astro&utm_source=astro',
	},
];

// const mainSponsors = [
// ];

const sponsors = [
	{
		height: 64,
		label: 'ArcJet',
		src: 'sponsors/arcjet',
		href: 'https://arcjet.com/?ref=astro.build',
	},
	{
		height: 23,
		label: 'HandsOnTable',
		src: 'sponsors/handsontable',
		href: 'https://handsontable.com/',
	},
	{
		height: 25,
		label: 'Lucky Media',
		src: 'sponsors/lucky-media',
		href: 'https://www.luckymedia.dev/astro-development-agency?utm_campaign=sponsor&amp;utm_source=astro&amp;utm_medium=web',
	},
	{
		height: 60,
		label: 'Datadog',
		src: 'sponsors/datadog',
		href: 'https://www.datadoghq.com/',
	},
	{
		height: 42,
		label: 'Duende',
		src: 'sponsors/duende',
		href: 'https://duendesoftware.com/',
	},
	{
		height: 25,
		label: 'Databento',
		src: 'sponsors/databento',
		href: 'https://databento.com/?utm_source=astro&utm_medium=sponsor&utm_content=display',
	},
	{
		height: 25,
		label: 'Localazy',
		src: 'sponsors/localazy',
		href: 'https://localazy.com/',
	},
];

/** Iterate over an array in chunks of a given size. */
function* chunk<T>(array: T[], chunkSize: number) {
	for (let i = 0; i < array.length; i += chunkSize) {
		yield array.slice(i, i + chunkSize);
	}
}
/** Break an array into rows of 2 or 3 items, choosing the column count that results in the fullest final row. */
function rows<T>(array: T[]): T[][] {
	const columnCount = array.length % 2 > array.length % 3 ? 3 : 2;
	return [...chunk(array, columnCount)];
}

const largeSponsorRows = [...rows(exclusiveSponsors) /*...rows(mainSponsors)*/];
---

<section class="mt-20 md:mt-24 lg:mt-28 xl:mt-36 w-full max-w-screen-xl mx-auto px-4 sm:px-8">
	<h2
		class="max-w-screen-md mx-auto font-heading text-2xl lg:text-3xl font-bold text-white text-balance text-center"
	>
		Astro is free, open-source software made possible by these wonderful sponsors
	</h2>

	<div
		class="mt-8 lg:mt-10 max-w-4xl w-full mx-auto border border-astro-dark-100/20 bg-astro-dark-800 rounded-xl sm:rounded-2xl overflow-hidden"
	>
		{
			largeSponsorRows.map((group, index, rows) => (
				<div
					class:list={[
						{ 1: 'lg:grid-cols-1', 2: 'lg:grid-cols-2', 3: 'lg:grid-cols-3' }[group.length],
						'lg:h-60 lg:grid lg:grid-rows-[1fr_auto_auto_1fr] lg:gap-y-4 text-center items-center justify-center lg:divide-x divide-y lg:divide-y-0 divide-astro-dark-100/20',
						{ 'border-b border-astro-dark-100/20': index < rows.length - 1 },
					]}
				>
					{group.map((sponsor) => (
						<a
							href={sponsor.href}
							rel="sponsored"
							target="_blank"
							class="h-40 p-4 size-full basis-1/3 flex flex-col lg:grid lg:grid-rows-subgrid lg:row-span-full items-center justify-center gap-4 -outline-offset-2 hover:bg-astro-gray-100/5 bg-clip-padding transition-colors duration-400"
						>
							<StripWidth>
								<Icon
									class="lg:row-start-2 lg:mx-auto max-w-full"
									name={sponsor.src}
									height={sponsor.height}
									aria-hidden="true"
								/>
							</StripWidth>
							<span class="sr-only">{sponsor.label}</span>
							<span class="lg:row-start-3 font-light text-astro-gray-300">{sponsor.caption}</span>
						</a>
					))}
				</div>
			))
		}

		<div class="grid grid-cols-2 lg:flex lg:flex-wrap divide-y divide-astro-dark-100/20">
			{
				sponsors.map((sponsor) => (
					<a
						href={sponsor.href}
						rel="sponsored"
						target="_blank"
						class="h-32 lg:h-44 grow shrink basis-1/2 p-4 lg:basis-1/4 flex flex-col items-center justify-center gap-2 sm:gap-4 first:border-t first:border-astro-dark-100/20 odd:border-r odd:border-astro-dark-100/20 lg:[&:nth-child(2)]:border-r lg:[&:nth-child(6)]:border-r lg:[&:nth-child]:border-astro-dark-100/20 hover:bg-astro-gray-100/5 bg-clip-padding transition-colors  duration-400 last:odd:col-span-2 last:odd:border-r-0 -outline-offset-2"
					>
						<StripWidth>
							<Icon
								name={sponsor.src}
								height={sponsor.height}
								aria-hidden="true"
								class="max-w-full"
							/>
						</StripWidth>
						<span class="sr-only">{sponsor.label}</span>
					</a>
				))
			}
			<a
				href="https://opencollective.com/astrodotbuild"
				rel="sponsored"
				target="_blank"
				class="h-32 lg:h-44 grow shrink basis-1/2 p-4 lg:basis-1/4 flex flex-col items-center justify-center gap-2 first:border-t first:border-astro-dark-100/20 odd:border-r odd:border-astro-dark-100/20 lg:[&:nth-child(2)]:border-r lg:[&:nth-child(6)]:border-r lg:[&:nth-child]:border-astro-dark-100/20 hover:bg-astro-gray-100/5 bg-clip-padding transition-colors duration-400 last:odd:col-span-2 last:odd:border-r-0 -outline-offset-2"
			>
				<Icon
					name="heart"
					width="24"
					height="24"
					aria-hidden="true"
					class="max-w-full text-astro-red"
				/>
				<span class="text-astro-gray-200 text-center leading-snug">Sponsor Astro</span>
			</a>
		</div>
	</div>
</section>
