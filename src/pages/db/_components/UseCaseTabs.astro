---
import Tab from "./UseCaseTab.astro"
import Comments from "./use-cases/Comments.astro"
import Forms from "./use-cases/Forms.astro"
import Feedback from "./use-cases/Feedback.astro"
import Blog from "./use-cases/Blog.astro"
import Auth from "./use-cases/Auth.astro"
---

<astro-db-tabs class="relative">
	<ul
		class="align-start -ml-4 mt-4 flex flex-wrap items-start justify-start gap-4 pt-8 text-astro-gray-200 sm:min-h-[10rem]"
	>
		<Tab title="Comments" icon="uil:comments-alt" active />
		<Tab title="Blog" icon="uil:notes" />
		<Tab title="Forms" icon="uil:document-layout-left" />
		<Tab title="Feedback" icon="uil:question-circle" />
		<Tab title="Auth" icon="uil:users-alt" />
	</ul>

	<ul class="mt-20">
		<Blog />
		<Comments />
		<Forms />
		<Feedback />
		<Auth />
	</ul>
</astro-db-tabs>

<script>
	// @ts-nocheck
	const bind = (instance, proto) => {
		if (proto == null) {
			proto = Object.getPrototypeOf(instance)
		}
		let propertyNames = Object.getOwnPropertyNames(proto)
		for (let name of propertyNames) {
			let value = proto[name]
			if (typeof value === "function") {
				instance[name] = proto[name].bind(instance)
			}
		}
	}
	class Tabs extends HTMLElement {
		static is = "astro-db-tabs"

		constructor() {
			super()
			bind(this)
		}

		button(name) {
			return this.querySelector(`button[data-tab="${name}"]`)
		}
		buttons() {
			return this.querySelectorAll(`button[data-tab]`)
		}
		content(name) {
			return this.querySelector(`li[data-tab="${name}"]`)
		}
		contents() {
			return this.querySelectorAll(`li[data-tab]`)
		}

		connectedCallback() {
			this.addEventListener("click", this.handleClick)
		}

		disconnectedCallback() {
			this.removeEventListener("click", this.handleClick)
		}

		resetElements() {
			for (const button of this.buttons()) {
				button.removeAttribute("aria-selected")
			}
			for (const content of this.contents()) {
				content.classList.add("hidden")
			}
		}

		setActive(name) {
			const button = this.button(name)
			const content = this.content(name)

			console.log({ button, content })

			button.setAttribute("aria-selected", "true")
			content.classList.remove("hidden")
		}

		handleClick(event: Event) {
			const name = event.target.closest("button[data-tab]")?.dataset.tab
			if (!name) return

			if ("startViewTransition" in document) {
				document.startViewTransition(() => {
					this.resetElements()
					this.setActive(name)
				})
			} else {
				this.resetElements()
				this.setActive(name)
			}
		}
	}

	customElements.define(Tabs.is, Tabs)
</script>
